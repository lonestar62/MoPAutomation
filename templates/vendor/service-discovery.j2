{# METADATA:
id: service-discovery
name: Service Discovery
description: Configure service discovery and registration
estimated_duration: 30
risk_level: low
approval_required: false
dependencies: []
#}

# Service Discovery - {{ region.upper() }}

## Overview

Service discovery configuration procedure for **{{ azure_region }}** region.

### Service Discovery Context

- **Target Region**: {{ region.upper() }} ({{ azure_region }})
- **Discovery Service**: {{ discovery_service | default('Consul') }}
- **Registration Method**: {{ registration_method | default('Automatic') }}

## Service Registration

### Application Services
```bash
# Register web services
ansible {{ region }}_web -m template -a "
  src=consul-service.json.j2
  dest=/etc/consul.d/web-service.json
"

# Register database services
ansible {{ region }}_db -m template -a "
  src=consul-service.json.j2
  dest=/etc/consul.d/db-service.json
"

# Reload consul configuration
ansible {{ region }}_all -m systemd -a "name=consul state=reloaded"
```

### Health Check Registration
```bash
# Configure health checks
ansible {{ region }}_all -m template -a "
  src=health-check.json.j2
  dest=/etc/consul.d/health-check.json
"
```

---

**Generated**: {{ generated_at }}  
**Template**: {{ template_source }}  
**Region**: {{ region.upper() }} ({{ azure_region }})